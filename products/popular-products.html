<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EgoMedi - Sản phẩm nổi bật</title>
    <!-- Google Fonts - Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'montserrat': ['Montserrat', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/product-menu-fix.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Breadcrumb Banner JS -->
    <script src="../assets/js/breadcrumb-banner.js"></script>
</head>
<body class="bg-gray-50 p-0 font-montserrat relative" style="background-image: url('https://bizweb.dktcdn.net/100/382/483/themes/758809/assets/bg-bottom-right.png?1705909553460'); background-repeat: no-repeat; background-position: bottom right; background-attachment: fixed; background-size: auto;">
    <!-- Header -->
    <div id="header"></div>

    <!-- Breadcrumb Banner -->
    <div id="page-header"></div>

    <!-- Main Content -->
    <main>
        <section class="py-10 px-4 bg-white">
            <div class="max-w-7xl mx-auto">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                    <!-- Sidebar Filters -->
                    <div class="lg:col-span-1">
                        <div class="bg-white rounded-lg shadow-sm border p-6 sticky top-4">
                            <!-- Category Menu -->
                            <div class="mb-8">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b border-cyan-500 pb-2">
                                    DANH MỤC ĐIỀU TRỊ
                                </h3>
                                <ul class="space-y-2" id="category-menu">
                                    <li><a href="../index.html" class="text-gray-600 hover:text-cyan-500 block py-1">Trang chủ</a></li>
                                    <li><a href="../gioi-thieu.html" class="text-gray-600 hover:text-cyan-500 block py-1">Giới thiệu</a></li>
                                    <li><a href="../appointment.html" class="text-gray-600 hover:text-cyan-500 block py-1">Đặt lịch hẹn</a></li>
                                    <li><a href="../products.html" class="text-gray-600 hover:text-cyan-500 block py-1">Tất cả sản phẩm</a></li>
                                    <li><a href="../products/popular-products.html" class="text-cyan-500 font-medium block py-1">Sản phẩm nổi bật</a></li>
                                    <li><a href="../news/news.html" class="text-gray-600 hover:text-cyan-500 block py-1">Tin tức</a></li>
                                    <li><a href="../contact.html" class="text-gray-600 hover:text-cyan-500 block py-1">Liên hệ</a></li>
                                </ul>
                            </div>

                            <!-- Popular Categories -->
                            <div class="mb-8">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">DANH MỤC NỔI BẬT</h3>
                                <ul class="space-y-2" id="popular-categories">
                                    <li><label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2" value="bestseller"> Best Seller</label></li>
                                    <li><label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2" value="new-arrival"> Hàng mới về</label></li>
                                    <li><label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2" value="featured"> Nổi bật</label></li>
                                    <li><label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2" value="sale"> Khuyến mãi</label></li>
                                </ul>
                            </div>

                            <!-- Brand Filter -->
                            <div class="mb-8">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">THƯƠNG HIỆU</h3>
                                <ul class="space-y-2" id="brand-filter">
                                    <li><label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2" value="omron"> Omron</label></li>
                                    <li><label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2" value="dr-kovik"> Dr Kovik</label></li>
                                    <li><label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2" value="nagakawa"> Nagakawa</label></li>
                                    <li><label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2" value="bliss"> Bliss</label></li>
                                    <li><label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-2" value="beurer"> Beurer</label></li>
                                </ul>
                            </div>

                            <!-- Price Filter -->
                            <div class="mb-8">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">GIÁ SẢN PHẨM</h3>
                                <ul class="space-y-2" id="price-filter">
                                    <li><label class="flex items-center cursor-pointer"><input type="radio" name="price" class="mr-2" value="0-1000000"> Giá dưới 1.000.000₫</label></li>
                                    <li><label class="flex items-center cursor-pointer"><input type="radio" name="price" class="mr-2" value="1000000-2000000"> 1.000.000₫ - 2.000.000₫</label></li>
                                    <li><label class="flex items-center cursor-pointer"><input type="radio" name="price" class="mr-2" value="2000000-5000000"> 2.000.000₫ - 5.000.000₫</label></li>
                                    <li><label class="flex items-center cursor-pointer"><input type="radio" name="price" class="mr-2" value="5000000-10000000"> 5.000.000₫ - 10.000.000₫</label></li>
                                </ul>
                                
                                <!-- Clear price filter button -->
                                <button id="clear-price-filter" class="mt-3 text-sm text-cyan-500 hover:text-cyan-600">
                                    Xóa bộ lọc giá
                                </button>
                            </div>

                            <!-- Clear all filters button -->
                            <button id="clear-all-filters" class="w-full px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors duration-300">
                                Xóa tất cả bộ lọc
                            </button>
                        </div>
                    </div>

                    <!-- Products Area -->
                    <div class="lg:col-span-3">
                        <!-- Products Header -->
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                            <div>
                                <h1 class="text-2xl font-bold text-gray-800 mb-2">Sản phẩm nổi bật</h1>
                                <p class="text-gray-600" id="product-count">Hiển thị 0 sản phẩm</p>
                            </div>
                            
                            <!-- Sort Options -->
                            <div class="flex items-center gap-4">
                                <span class="text-gray-600">Sắp xếp:</span>
                                <select id="sort-select" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500">
                                    <option value="default">Thứ tự mặc định</option>
                                    <option value="name-asc">Tên A-Z</option>
                                    <option value="name-desc">Tên Z-A</option>
                                    <option value="price-asc">Giá thấp đến cao</option>
                                    <option value="price-desc">Giá cao đến thấp</option>
                                    <option value="popularity">Độ phổ biến</option>
                                </select>
                            </div>
                        </div>

                        <!-- Products Grid Container -->
                        <div id="products-container">
                            <!-- Products will be loaded here by ProductGrid -->
                        </div>

                        <!-- Pagination -->
                        <div id="pagination-container" class="flex justify-center mt-8">
                            <!-- Pagination will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Floating Action Buttons (FAB) on left side -->
    <div class="fab-container">
        <!-- Zalo Button -->
        <div class="fab-button zalo">
            <i class="fas fa-comment-dots"></i>
        </div>
        
        <!-- Messenger Button -->
        <div class="fab-button messenger">
            <i class="fab fa-facebook-messenger"></i>
        </div>
        
        <!-- Phone Button -->
        <div class="fab-button phone">
            <i class="fas fa-phone"></i>
        </div>
        
        <!-- Help/Question Button (Largest) -->
        <div class="fab-button large help">
            <i class="far fa-question-circle"></i>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer"></div>

    <!-- JavaScript -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/product-grid.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            new BreadcrumbBanner('page-header', {
                currentPage: 'Sản phẩm nổi bật',
                backgroundImage: 'https://bizweb.dktcdn.net/100/382/483/themes/758809/assets/bg_bread_crumb.jpg?1705634372536'
            });
            
            // Initialize popular products page
            initPopularProductsPage();
        });

        function initPopularProductsPage() {
            // Filter popular products (products with originalPrice - indicating sale/discount)
            const popularProducts = medicalProducts.filter(product => 
                product.originalPrice || 
                product.category === 'medical-device' || 
                ['omron', 'beurer', 'bliss'].includes(product.brand)
            );

            // Initialize ProductGrid with pagination
            const productGrid = new ProductGrid('products-container', {
                columns: { sm: 2, lg: 3 },
                gap: 6,
                showPagination: true,
                itemsPerPage: 8,
                onProductClick: function(product) {
                    window.location.href = `product-detail.html?id=${product.id}`;
                }
            });

            // Set products and render
            productGrid
                .setProducts([...popularProducts])
                .render()
                .setupEventListeners();

            // Store references for filtering
            let allProducts = [...popularProducts];
            let filteredProducts = [...allProducts];

            // Update product count initially
            updateProductCount();

            // Setup filter event listeners
            setupFilterListeners();

            function setupFilterListeners() {
                // Popular categories filter
                document.getElementById('popular-categories').addEventListener('change', applyFilters);
                
                // Brand filter
                document.getElementById('brand-filter').addEventListener('change', applyFilters);
                
                // Price filter
                document.getElementById('price-filter').addEventListener('change', applyFilters);
                
                // Sort select
                document.getElementById('sort-select').addEventListener('change', function() {
                    const sortedProducts = sortProducts([...filteredProducts], this.value);
                    productGrid.setProducts(sortedProducts).render();
                });

                // Clear price filter
                document.getElementById('clear-price-filter').addEventListener('click', function() {
                    const priceInputs = document.querySelectorAll('#price-filter input[type="radio"]');
                    priceInputs.forEach(input => input.checked = false);
                    applyFilters();
                });

                // Clear all filters
                document.getElementById('clear-all-filters').addEventListener('click', function() {
                    // Clear all checkboxes and radio buttons
                    const allInputs = document.querySelectorAll('#popular-categories input, #brand-filter input, #price-filter input');
                    allInputs.forEach(input => input.checked = false);
                    
                    // Reset sort select
                    document.getElementById('sort-select').value = 'default';
                    
                    // Reset filtered products and re-render
                    filteredProducts = [...allProducts];
                    productGrid.setProducts(filteredProducts).render();
                    updateProductCount();
                });
            }

            function applyFilters() {
                filteredProducts = [...allProducts];

                // Apply popular categories filter
                const selectedCategories = Array.from(document.querySelectorAll('#popular-categories input:checked'))
                    .map(cb => cb.value);
                if (selectedCategories.length > 0) {
                    filteredProducts = filteredProducts.filter(product => {
                        if (selectedCategories.includes('bestseller')) {
                            return ['omron', 'beurer'].includes(product.brand);
                        }
                        if (selectedCategories.includes('new-arrival')) {
                            return product.category === 'thermometer';
                        }
                        if (selectedCategories.includes('featured')) {
                            return product.category === 'medical-device';
                        }
                        if (selectedCategories.includes('sale')) {
                            return product.originalPrice;
                        }
                        return true;
                    });
                }

                // Apply brand filter
                const selectedBrands = Array.from(document.querySelectorAll('#brand-filter input:checked'))
                    .map(cb => cb.value);
                if (selectedBrands.length > 0) {
                    filteredProducts = filteredProducts.filter(product => 
                        selectedBrands.some(brand => 
                            (product.brand && product.brand.toLowerCase().includes(brand.toLowerCase())) ||
                            product.name.toLowerCase().includes(brand.toLowerCase())
                        )
                    );
                }

                // Apply price filter
                const selectedPrice = document.querySelector('#price-filter input:checked');
                if (selectedPrice) {
                    const [min, max] = selectedPrice.value.split('-').map(Number);
                    filteredProducts = filteredProducts.filter(product => 
                        product.price >= min && product.price <= max
                    );
                }

                // Apply current sort
                const currentSort = document.getElementById('sort-select').value;
                filteredProducts = sortProducts(filteredProducts, currentSort);

                // Update grid with filtered products
                productGrid.setProducts(filteredProducts).render();
                updateProductCount();
            }

            function sortProducts(products, sortValue) {
                const sortedProducts = [...products];
                
                switch(sortValue) {
                    case 'name-asc':
                        return sortedProducts.sort((a, b) => a.name.localeCompare(b.name));
                    case 'name-desc':
                        return sortedProducts.sort((a, b) => b.name.localeCompare(a.name));
                    case 'price-asc':
                        return sortedProducts.sort((a, b) => a.price - b.price);
                    case 'price-desc':
                        return sortedProducts.sort((a, b) => b.price - a.price);
                    case 'popularity':
                        // Sort by brand popularity and then by price
                        return sortedProducts.sort((a, b) => {
                            const popularBrands = ['omron', 'beurer', 'bliss'];
                            const aPopular = popularBrands.includes(a.brand) ? 0 : 1;
                            const bPopular = popularBrands.includes(b.brand) ? 0 : 1;
                            if (aPopular !== bPopular) return aPopular - bPopular;
                            return b.price - a.price; // Higher price first for same popularity
                        });
                    default:
                        return sortedProducts;
                }
            }

            function updateProductCount() {
                document.getElementById('product-count').textContent = 
                    `Hiển thị ${filteredProducts.length} sản phẩm`;
            }
        }
    </script>
</body>
</html>
